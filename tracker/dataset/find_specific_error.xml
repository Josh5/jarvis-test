<!--
     This dataset provides a list of the errors that have occurred.
     First REST parameter can be the application, if so wanted.
     Second REST parameter can be the user, if so wanted.

     It then identifies how many errors in a specific error is - 
     either an error given by a specific ID, or an error given by
     a date.

     Filter criteria can be provided, the same as the 'errors.xml'
     dataset.

     Note that we add a day to the date (by subtracting 1), because
     we want to show the user the last errors on the given date, not
     start the user off immediately after that date.
  -->
<dataset read="*" write="">
    <select>
        SELECT
            count(*) AS number_in
        FROM
            error
        WHERE
            ({$1}::text IS NULL OR lower(app_name) = lower({$1}))
            AND ({$2}::text IS NULL OR lower(username) = lower({$2}))
            AND
            (
                {$filter}::text IS NULL OR {$filter} = ''
                OR
                id IN (SELECT id FROM error WHERE sid LIKE '%' || {$filter} || '%')
                OR
                id IN (SELECT id FROM error WHERE username LIKE '%' || {$filter} || '%')
                OR
                id IN (SELECT id FROM error WHERE dataset LIKE '%' || {$filter} || '%')
                OR
                id IN (SELECT id FROM error WHERE params LIKE '%' || {$filter} || '%')
                OR
                id IN (SELECT id FROM error WHERE message LIKE '%' || {$filter} || '%')
                OR
                id IN (SELECT id FROM error WHERE post_body LIKE '%' || {$filter} || '%')
            )
            AND ({$id}::integer IS NULL OR id > {$id})
            AND ({$date}::timestamp IS NULL OR start_time > ({$date}::timestamp + '1 day'))
    </select>
</dataset>

