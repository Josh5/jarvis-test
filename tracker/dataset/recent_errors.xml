<!--
     This dataset provides a list of the recent errors that have occurred.
     First REST parameter can be the application, if so wanted.
     Second REST parameter can be the user, if so wanted.

     This request is slightly different to the errors.xml file in that it 
     limits to the most recent 15, there is no filtering bar the 
     application name and the resulting data is limited to a few fields only.

     Errors are returned latest error first.

     This error list is designed for showing 'recent' errors, which a user could
     then review in more detail using the 'errors.xml' dataset.

     This also limits the errors returned to those that don't appear to be 'normal'
     requests before login.
  -->

<dataset read="*" write="">
    <select>
        SELECT
            id,
            app_name,
            username,
            message,
            strftime('%Y-%m-%dT%H:%M:%S', start_time, 'localtime')  AS start_time
        FROM
            error
        WHERE
            ({$1} IS NULL OR lower(app_name) = lower({$1}))
            AND ({$2} IS NULL OR lower(username) = lower({$2}))
            AND NOT (http_response_code = 401 AND (username = '' OR username IS NULL))
        ORDER BY
            start_time DESC
        LIMIT 30
    </select>
</dataset>

