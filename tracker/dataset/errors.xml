<!--
     This dataset provides a list of the errors that have occurred.
     First REST parameter can be the application, if so wanted.
     Second REST parameter can be the user, if so wanted.

     Errors are returned latest error first.

     Jarvis is expected to do paging on this data.
  -->
<dataset read="*" write="">
    <select>
        SELECT
            id,
            sid,
            app_name,
            username,
            group_list,
            dataset,
            action,
            params,
            post_body,
            message,
            to_char(start_time, 'YYYY-MM-DD HH24:MI:SS') AS start_time
        FROM
            error
        WHERE
            ({$1}::text IS NULL OR lower(app_name) = lower({$1}))
            AND ({$2}::text IS NULL OR lower(username) = lower({$2}))
            AND
            (
                {$filter}::text IS NULL OR {$filter} = ''
                OR
                id IN (SELECT id FROM error WHERE sid LIKE '%' || {$filter} || '%')
                OR
                id IN (SELECT id FROM error WHERE username LIKE '%' || {$filter} || '%')
                OR
                id IN (SELECT id FROM error WHERE dataset LIKE '%' || {$filter} || '%')
                OR
                id IN (SELECT id FROM error WHERE params LIKE '%' || {$filter} || '%')
                OR
                id IN (SELECT id FROM error WHERE message LIKE '%' || {$filter} || '%')
                OR
                id IN (SELECT id FROM error WHERE post_body LIKE '%' || {$filter} || '%')
            )
        ORDER BY
            start_time DESC
    </select>
</dataset>
