<!--
NOTE: The {$from} and {$to} parameters for this dataset are given in julian format (days since 4713-01-01 12:00:00 BC)
-->
<dataset read="*">
    <select>
        SELECT
            julian(start_time) AS start_time_raw,
            to_char(start_time, 'YYYY-MM-DD HH24:MI:SS.MS') AS start_time,
            to_char(start_time + '1 millisecond'::interval * duration_ms, 'YYYY-MM-DD HH24:MI:SS.MS') AS end_time,
            (CASE WHEN duration_ms &lt; 1000 THEN '1' ELSE '0' END) as instant,
            app_name, 
            username, 
            dataset,
            params,
            in_nrows,
            out_nrows,
            '' AS error
        FROM 
            request 
        WHERE 
            ({$sid}::integer IS NULL OR sid = {$sid})
            AND ({$user}::text IS NULL OR username = {$user})
            AND ({$app_name}::text IS NULL OR app_name = {$app_name})
            AND ({$dataset}::text IS NULL OR dataset = {$dataset})
            AND ({$from}::double precision IS NULL OR julian(start_time) >= {$from})
            AND ({$to}::double precision IS NULL OR julian(start_time) &lt;= {$to})
            AND ({$text}::text IS NULL OR params like '%' || {$text} || '%')
        UNION
        SELECT 
            julian(start_time) AS start_time_raw,
            to_char(start_time, 'YYYY-MM-DD HH24:MI:SS.MS') AS start_time,
            to_char(start_time, 'YYYY-MM-DD HH24:MI:SS.MS') AS end_time,
            '1' as instant,
            app_name, 
            username, 
            dataset,
            params,
            0 AS in_nrows,
            0 AS out_nrows,
            message AS error
        FROM 
            error 
        WHERE 
            ({$sid}::integer IS NULL OR sid = {$sid})
            AND ({$user}::text IS NULL OR username = {$user})
            AND ({$app_name}::text IS NULL OR app_name = {$app_name})
            AND ({$dataset}::text IS NULL OR dataset = {$dataset})
            AND ({$from}::double precision IS NULL OR julian(start_time) >= {$from})
            AND ({$to}::double precision IS NULL OR julian(start_time) &lt;= {$to})
            AND ({$text}::text IS NULL OR params like '%' || {$text} || '%' OR post_body like '%' || {$text} || '%' OR message like '%' || {$text} || '%')
        ORDER BY
            start_time_raw
    </select>
</dataset>
