<dataset read="*">
    <select>
        SELECT 
            start_time AS start_time_raw,
            strftime('%Y-%m-%d %H:%M:%fZ',start_time) AS start_time, 
            strftime('%Y-%m-%d %H:%M:%fZ',start_time + duration_ms * (1.0 / (1000 * 60 * 60 * 24))) AS end_time, 
            (CASE WHEN duration_ms &lt; 1000 THEN '1' ELSE '0' END) as instant,
            app_name, 
            username, 
            dataset,
            params,
            in_nrows,
            out_nrows,
            '' AS error
        FROM 
            request 
        WHERE 
            ({$sid} IS NULL OR sid = {$sid})
            AND ({$user} IS NULL OR username = {$user})
            AND ({$app_name} IS NULL OR app_name = {$app_name})
            AND ({$dataset} IS NULL OR dataset = {$dataset})
            AND ({$from} IS NULL OR start_time >= {$from})
            AND ({$to} IS NULL OR start_time &lt;= {$to})
            AND ({$text} IS NULL OR params like '%' || {$text} || '%')
        UNION
        SELECT 
            start_time AS start_time_raw,
            strftime('%Y-%m-%d %H:%M:%fZ',start_time) AS start_time, 
            strftime('%Y-%m-%d %H:%M:%fZ',start_time) AS end_time, 
            '1' as instant,
            app_name, 
            username, 
            dataset,
            params,
            0 AS in_nrows,
            0 AS out_nrows,
            message AS error
        FROM 
            error 
        WHERE 
            ({$sid} IS NULL OR sid = {$sid})
            AND ({$user} IS NULL OR username = {$user})
            AND ({$app_name} IS NULL OR app_name = {$app_name})
            AND ({$dataset} IS NULL OR dataset = {$dataset})
            AND ({$from} IS NULL OR start_time >= {$from})
            AND ({$to} IS NULL OR start_time &lt;= {$to})
            AND ({$text} IS NULL OR params like '%' || {$text} || '%' OR post_body like '%' || {$text} || '%' OR message like '%' || {$text} || '%')
        ORDER BY
            start_time_raw
    </select>
</dataset>
